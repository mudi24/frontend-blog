# 深入详细的对比 Vue3和Vue2

Vue 3 不是简单的 Vue 2 升级版，而是一次**从底层架构到开发范式**的彻底重构。如果说 Vue 2 是将 Web 开发平民化的“工具箱”，那么 Vue 3 就是为复杂大厂项目设计的“工程级引擎”。

以下是针对资深面试场景准备的深度对比：

---

## 1. 响应式系统：从“属性拦截”到“对象代理”

这是 Vue 3 最核心的改进（“换心手术”）。

* **Vue 2 (`Object.defineProperty`)**：
* **原理**：在初始化时递归遍历 data 对象，将属性转为 getter/setter。
* **痛点**：无法检测对象属性的**新增和删除**，无法原生监听**数组索引**改变（需通过 `$set` 补丁）。
* **性能消耗**：无论数据是否被用到，初始化时都会进行全量递归，造成内存压力。


* **Vue 3 (`Proxy`)**：
* **原理**：直接监听对象而非属性，支持 13 种拦截行为。
* **深度解答**：它是**懒递归**的。只有当访问到深层属性时，才会触发下一层的响应式转换，极大提升了初始化速度。
* **优势**：完美支持 Map、Set 等原生集合，彻底告别 `$set`。



---

## 2. 编程范式：Options API vs. Composition API

* **Options API (Vue 2)**：按 data, methods, computed 拆分。
* **局限**：在大型组件中，同一个业务逻辑的代码散落在文件的各个角落（“反复横跳”），导致维护极难。


* **Composition API (Vue 3)**：按**业务功能**组织代码。
* **逻辑复用**：彻底取代了 Vue 2 中带有命名冲突隐患的 `Mixins`，通过 `hook` 函数（如 `useUser`）实现逻辑的完美封装与组合。
* **类型推导**：Composition API 是为 TypeScript 诞生的，不再需要复杂的 `this` 类型定义。



---

## 3. 编译优化：静态提升与补丁标记

Vue 3 的模板编译器变“聪明”了。

* **静态提升 (Static Hoisting)**：Vue 3 会识别出模板中那些永远不会改变的 HTML 标签，并将它们提到渲染函数之外。这样每次渲染时，就不需要重新创建这些 VNode。
* **补丁标记 (Patch Flags)**：
* 在对比虚拟 DOM 时，Vue 2 会进行全量对比。
* Vue 3 在编译阶段会给带有动态绑定的标签打上 Flag（如：`TEXT` 或 `CLASS`）。在 Diff 时，**只对比标记了 Flag 的属性**，跳过静态节点。


* **树摇优化 (Tree-shaking)**：Vue 3 的全局 API（如 `nextTick`）现在通过命名导出。如果你没用它，打包工具会自动将其剔除，让产物更轻量。

---

## 4. 核心差异总结表

| 维度 | Vue 2 | Vue 3 |
| --- | --- | --- |
| **响应式底层** | `Object.defineProperty` (递归拦截) | **`Proxy` (代理整个对象)** |
| **代码组织** | Options API (配置式) | **Composition API (组合式)** |
| **TS 支持** | 较弱，需借助 `Vue.extend` 等 | **原生支持，体验极佳** |
| **碎片化支持** | 每个模板必须有唯一根节点 | **支持 Fragment (多根节点)** |
| **内置组件** | - | **新增 Teleport (传送门)、Suspense** |
| **Diff 算法** | 全量比对 | **静态提升 + 补丁标记 (按需比对)** |
| **包体积** | 较重 | **模块化、Tree-shaking 后更小** |

---

## 5. 架构深度：Monorepo 与模块解耦

Vue 3 源码采用了 **Monorepo** 管理模式（通过 pnpm workspaces）。

* **解耦性**：响应式系统 `@vue/reactivity` 已经可以独立于 Vue 框架在 Node.js 或其他环境中运行。
* **自定义渲染器 (Custom Renderer)**：Vue 3 暴露了 `createRenderer` API，开发者可以更轻松地将 Vue 扩展到 Canvas、iOS/Android 原生或各种 IoT 终端，这也是为什么 Vue 3 跨端生态更强大的原因。

---

### 💡 面试避坑指南：Vue 3 真的完美吗？

Vue 3 的唯一劣势是**不兼容 IE11**，因为 `Proxy` 是无法通过 Polyfill 完美模拟的。如果你的项目需要兼容老旧政府/银行系统，Vue 2 依然是唯一选型。
